Zookeeper와 Kafka는 함께 사용되며, 각자의 역할과 관계가 명확하게 정의되어 있습니다. 
Apache Kafka는 분산 스트리밍 플랫폼으로, 대규모 데이터 스트리밍을 처리하기 위해 설계되었습니다. 
Zookeeper는 Kafka 클러스터의 메타데이터 관리와 노드 간의 협력을 위한 분산 코디네이션 서비스입니다.

### Zookeeper와 Kafka의 관계

#### Zookeeper의 역할

1. **메타데이터 저장**:
   - Kafka 클러스터의 구성 정보(브로커 목록, 토픽, 파티션 등)를 저장하고 관리합니다.
   - Zookeeper는 Kafka 브로커가 시작될 때, 자신을 Zookeeper에 등록하고 메타데이터를 저장하는 데 사용됩니다.

2. **리더 선출**:
   - Kafka 파티션의 리더 브로커를 선출합니다. 리더 브로커는 해당 파티션의 읽기 및 쓰기 요청을 처리합니다.
   - Zookeeper는 리더 선출 과정에서 중재자 역할을 합니다.

3. **노드 상태 모니터링**:
   - Kafka 클러스터의 각 브로커의 상태를 모니터링합니다. 브로커가 정상인지, 실패했는지 등의 상태 정보를 유지합니다.
   - Zookeeper는 브로커가 실패하거나 새로운 브로커가 추가될 때 이를 감지하고, 클러스터의 상태를 업데이트합니다.

4. **구성 변경 관리**:
   - 새로운 토픽 생성, 파티션 추가 등과 같은 구성 변경 사항을 관리합니다.
   - Zookeeper를 통해 구성 변경이 모든 브로커에 일관되게 반영되도록 합니다.

#### Kafka의 역할

1. **메시지 스트리밍**:
   - Kafka는 고속 메시지 스트리밍을 위해 설계된 분산 메시지 브로커입니다.
   - 프로듀서(Producer)와 컨슈머(Consumer)를 통해 메시지를 생성하고 소비합니다.

2. **데이터 저장**:
   - Kafka는 메시지를 디스크에 저장하고, 높은 내구성과 신뢰성을 제공합니다.
   - 메시지는 토픽(Topic)과 파티션(Partition)으로 구성됩니다.

3. **브로커 간 데이터 복제**:
   - Kafka는 데이터의 고가용성을 위해 파티션 데이터를 여러 브로커에 복제합니다.
   - 리더 브로커와 팔로워 브로커 간의 데이터 복제를 통해 데이터의 내구성을 보장합니다.

### Kafka와 Zookeeper의 상호 작용

1. **클러스터 초기화**:
   - Kafka 브로커가 시작될 때, Zookeeper에 연결하여 자신을 등록합니다.
   - Zookeeper는 브로커의 메타데이터를 저장하고, 클러스터의 상태를 업데이트합니다.

2. **리더 선출**:
   - Kafka 파티션의 리더 브로커를 선출할 때, Zookeeper를 통해 중재가 이루어집니다.
   - Zookeeper는 리더 브로커와 팔로워 브로커의 역할을 조정합니다.

3. **브로커 상태 모니터링**:
   - Zookeeper는 주기적으로 브로커의 상태를 체크합니다.
   - 브로커가 실패하면, Zookeeper는 해당 브로커의 메타데이터를 업데이트하고, 다른 브로커를 리더로 선출합니다.

4. **구성 변경 반영**:
   - 새로운 토픽이나 파티션 추가와 같은 구성 변경이 있을 때, Zookeeper는 이를 모든 브로커에 일관되게 반영합니다.
   - 이를 통해 클러스터 내 모든 브로커가 최신 구성을 유지하도록 합니다.

### Zookeeper 없이 Kafka 사용

Zookeeper의 의존성을 줄이기 위해, 최근 Apache Kafka는 KRaft(Kafka Raft)를 도입하여 Zookeeper 없이도 작동할 수 있는 새로운 아키텍처를 도입하고 있습니다. KRaft는 Kafka 자체에서 메타데이터 관리를 포함한 Zookeeper의 역할을 수행합니다.

### 요약

- **Zookeeper**는 Kafka 클러스터의 메타데이터를 관리하고, 리더 선출, 노드 상태 모니터링, 구성 변경 관리 등을 담당합니다.
- **Kafka**는 고속 메시지 스트리밍과 데이터를 저장하고, 브로커 간 데이터 복제를 수행합니다.
- 두 시스템은 협력하여 안정적이고 고가용성의 분산 메시징 시스템을 구성합니다.
- 새로운 KRaft 아키텍처는 Zookeeper 없이도 Kafka가 작동할 수 있도록 하며, Zookeeper의 역할을 Kafka 내부에서 처리합니다.

Zookeeper와 Kafka는 이러한 협력을 통해 높은 내구성과 신뢰성을 제공하는 분산 메시징 시스템을 구성합니다.